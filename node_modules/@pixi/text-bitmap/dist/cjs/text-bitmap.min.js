/*!
 * @pixi/text-bitmap - v6.1.3
 * Compiled Mon, 13 Sep 2021 15:29:31 UTC
 *
 * @pixi/text-bitmap is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var math=require("@pixi/math"),settings=require("@pixi/settings"),mesh=require("@pixi/mesh"),utils=require("@pixi/utils"),core=require("@pixi/core"),text=require("@pixi/text"),display=require("@pixi/display"),loaders=require("@pixi/loaders"),extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};function __extends(t,e){function r(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var BitmapFontData=function(){return function(){this.info=[],this.common=[],this.page=[],this.char=[],this.kerning=[]}}(),TextFormat=function(){function t(){}return t.test=function(t){return"string"==typeof t&&0===t.indexOf("info face=")},t.parse=function(t){var e=t.match(/^[a-z]+\s+.+$/gm),r={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[]};for(var i in e){var n=e[i].match(/^[a-z]+/gm)[0],a=e[i].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),o={};for(var s in a){var h=a[s].split("="),l=h[0],u=h[1].replace(/"/gm,""),f=parseFloat(u),c=isNaN(f)?u:f;o[l]=c}r[n].push(o)}var p=new BitmapFontData;return r.info.forEach(function(t){return p.info.push({face:t.face,size:parseInt(t.size,10)})}),r.common.forEach(function(t){return p.common.push({lineHeight:parseInt(t.lineHeight,10)})}),r.page.forEach(function(t){return p.page.push({id:parseInt(t.id,10),file:t.file})}),r.char.forEach(function(t){return p.char.push({id:parseInt(t.id,10),page:parseInt(t.page,10),x:parseInt(t.x,10),y:parseInt(t.y,10),width:parseInt(t.width,10),height:parseInt(t.height,10),xoffset:parseInt(t.xoffset,10),yoffset:parseInt(t.yoffset,10),xadvance:parseInt(t.xadvance,10)})}),r.kerning.forEach(function(t){return p.kerning.push({first:parseInt(t.first,10),second:parseInt(t.second,10),amount:parseInt(t.amount,10)})}),p},t}(),XMLFormat=function(){function t(){}return t.test=function(t){return t instanceof XMLDocument&&t.getElementsByTagName("page").length&&null!==t.getElementsByTagName("info")[0].getAttribute("face")},t.parse=function(t){for(var e=new BitmapFontData,r=t.getElementsByTagName("info"),i=t.getElementsByTagName("common"),n=t.getElementsByTagName("page"),a=t.getElementsByTagName("char"),o=t.getElementsByTagName("kerning"),s=0;s<r.length;s++)e.info.push({face:r[s].getAttribute("face"),size:parseInt(r[s].getAttribute("size"),10)});for(s=0;s<i.length;s++)e.common.push({lineHeight:parseInt(i[s].getAttribute("lineHeight"),10)});for(s=0;s<n.length;s++)e.page.push({id:parseInt(n[s].getAttribute("id"),10)||0,file:n[s].getAttribute("file")});for(s=0;s<a.length;s++){var h=a[s];e.char.push({id:parseInt(h.getAttribute("id"),10),page:parseInt(h.getAttribute("page"),10)||0,x:parseInt(h.getAttribute("x"),10),y:parseInt(h.getAttribute("y"),10),width:parseInt(h.getAttribute("width"),10),height:parseInt(h.getAttribute("height"),10),xoffset:parseInt(h.getAttribute("xoffset"),10),yoffset:parseInt(h.getAttribute("yoffset"),10),xadvance:parseInt(h.getAttribute("xadvance"),10)})}for(s=0;s<o.length;s++)e.kerning.push({first:parseInt(o[s].getAttribute("first"),10),second:parseInt(o[s].getAttribute("second"),10),amount:parseInt(o[s].getAttribute("amount"),10)});return e},t}(),XMLStringFormat=function(){function t(){}return t.test=function(t){if("string"==typeof t&&t.indexOf("<font>")>-1){var e=(new self.DOMParser).parseFromString(t,"text/xml");return XMLFormat.test(e)}return!1},t.parse=function(t){var e=(new self.DOMParser).parseFromString(t,"text/xml");return XMLFormat.parse(e)},t}(),formats=[TextFormat,XMLFormat,XMLStringFormat];function autoDetectFormat(t){for(var e=0;e<formats.length;e++)if(formats[e].test(t))return formats[e];return null}function generateFillStyle(t,e,r,i,n,a){var o,s=r.fill;if(!Array.isArray(s))return s;if(1===s.length)return s[0];var h=r.dropShadow?r.dropShadowDistance:0,l=r.padding||0,u=t.width/i-h-2*l,f=t.height/i-h-2*l,c=s.slice(),p=r.fillGradientStops.slice();if(!p.length)for(var g=c.length+1,d=1;d<g;++d)p.push(d/g);if(c.unshift(s[0]),p.unshift(0),c.push(s[s.length-1]),p.push(1),r.fillGradientType===text.TEXT_GRADIENT.LINEAR_VERTICAL){o=e.createLinearGradient(u/2,l,u/2,f+l);var m=0,x=(a.fontProperties.fontSize+r.strokeThickness)/f;for(d=0;d<n.length;d++)for(var v=a.lineHeight*d,y=0;y<c.length;y++){var _=v/f+("number"==typeof p[y]?p[y]:y/c.length)*x,b=Math.max(m,_);b=Math.min(b,1),o.addColorStop(b,c[y]),m=b}}else{o=e.createLinearGradient(l,f/2,u+l,f/2);var w=c.length+1,T=1;for(d=0;d<c.length;d++){var S=void 0;S="number"==typeof p[d]?p[d]:T/w,o.addColorStop(S,c[d]),T++}}return o}function drawGlyph(t,e,r,i,n,a,o){var s=r.text,h=r.fontProperties;e.translate(i,n),e.scale(a,a);var l=o.strokeThickness/2,u=-o.strokeThickness/2;e.font=o.toFontString(),e.lineWidth=o.strokeThickness,e.textBaseline=o.textBaseline,e.lineJoin=o.lineJoin,e.miterLimit=o.miterLimit,e.fillStyle=generateFillStyle(t,e,o,a,[s],r),e.strokeStyle=o.stroke;var f=o.dropShadowColor,c=utils.hex2rgb("number"==typeof f?f:utils.string2hex(f));o.dropShadow?(e.shadowColor="rgba("+255*c[0]+","+255*c[1]+","+255*c[2]+","+o.dropShadowAlpha+")",e.shadowBlur=o.dropShadowBlur,e.shadowOffsetX=Math.cos(o.dropShadowAngle)*o.dropShadowDistance,e.shadowOffsetY=Math.sin(o.dropShadowAngle)*o.dropShadowDistance):(e.shadowColor="black",e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0),o.stroke&&o.strokeThickness&&e.strokeText(s,l,u+r.lineHeight-h.descent),o.fill&&e.fillText(s,l,u+r.lineHeight-h.descent),e.setTransform(1,0,0,1,0,0),e.fillStyle="rgba(0, 0, 0, 0)"}function resolveCharacters(t){"string"==typeof t&&(t=[t]);for(var e=[],r=0,i=t.length;r<i;r++){var n=t[r];if(Array.isArray(n)){if(2!==n.length)throw new Error("[BitmapFont]: Invalid character range length, expecting 2 got "+n.length+".");var a=n[0].charCodeAt(0),o=n[1].charCodeAt(0);if(o<a)throw new Error("[BitmapFont]: Invalid character range.");for(var s=a,h=o;s<=h;s++)e.push(String.fromCharCode(s))}else e.push.apply(e,n.split(""))}if(0===e.length)throw new Error("[BitmapFont]: Empty set when resolving characters.");return e}var BitmapFont=function(){function t(t,e,r){var i=t.info[0],n=t.common[0],a=t.page[0],o=utils.getResolutionOfUrl(a.file),s={};this._ownsTextures=r,this.font=i.face,this.size=i.size,this.lineHeight=n.lineHeight/o,this.chars={},this.pageTextures=s;for(var h=0;h<t.page.length;h++){var l=t.page[h],u=l.id,f=l.file;s[u]=e instanceof Array?e[h]:e[f]}for(h=0;h<t.char.length;h++){var c=t.char[h],p=(u=c.id,c.page),g=t.char[h],d=g.x,m=g.y,x=g.width,v=g.height,y=g.xoffset,_=g.yoffset,b=g.xadvance;d/=o,m/=o,x/=o,v/=o,y/=o,_/=o,b/=o;var w=new math.Rectangle(d+s[p].frame.x/o,m+s[p].frame.y/o,x,v);this.chars[u]={xOffset:y,yOffset:_,xAdvance:b,kerning:{},texture:new core.Texture(s[p].baseTexture,w),page:p}}for(h=0;h<t.kerning.length;h++){var T=t.kerning[h],S=T.first,A=T.second,P=T.amount;S/=o,A/=o,P/=o,this.chars[A]&&(this.chars[A].kerning[S]=P)}}return t.prototype.destroy=function(){for(var t in this.chars)this.chars[t].texture.destroy(),this.chars[t].texture=null;for(var t in this.pageTextures)this._ownsTextures&&this.pageTextures[t].destroy(!0),this.pageTextures[t]=null;this.chars=null,this.pageTextures=null},t.install=function(e,r,i){var n;if(e instanceof BitmapFontData)n=e;else{var a=autoDetectFormat(e);if(!a)throw new Error("Unrecognized data format for font.");n=a.parse(e)}r instanceof core.Texture&&(r=[r]);var o=new t(n,r,i);return t.available[o.font]=o,o},t.uninstall=function(e){var r=t.available[e];if(!r)throw new Error("No font found named '"+e+"'");r.destroy(),delete t.available[e]},t.from=function(e,r,i){if(!e)throw new Error("[BitmapFont] Property `name` is required.");var n=Object.assign({},t.defaultOptions,i),a=n.chars,o=n.padding,s=n.resolution,h=n.textureWidth,l=n.textureHeight,u=resolveCharacters(a),f=r instanceof text.TextStyle?r:new text.TextStyle(r),c=h,p=new BitmapFontData;p.info[0]={face:f.fontFamily,size:f.fontSize},p.common[0]={lineHeight:f.fontSize};for(var g,d,m,x=0,v=0,y=0,_=[],b=0;b<u.length;b++){g||((g=document.createElement("canvas")).width=h,g.height=l,d=g.getContext("2d"),m=new core.BaseTexture(g,{resolution:s}),_.push(new core.Texture(m)),p.page.push({id:_.length-1,file:""}));var w=text.TextMetrics.measureText(u[b],f,!1,g),T=w.width,S=Math.ceil(w.height),A=Math.ceil(("italic"===f.fontStyle?2:1)*T);if(v>=l-S*s){if(0===v)throw new Error("[BitmapFont] textureHeight "+l+"px is too small for "+f.fontSize+"px fonts");--b,g=null,d=null,m=null,v=0,x=0,y=0}else if(y=Math.max(S+w.fontProperties.descent,y),A*s+x>=c)--b,v+=y*s,v=Math.ceil(v),x=0,y=0;else{drawGlyph(g,d,w,x,v,s,f);var P=w.text.charCodeAt(0);p.char.push({id:P,page:_.length-1,x:x/s,y:v/s,width:A,height:S,xoffset:0,yoffset:0,xadvance:Math.ceil(T-(f.dropShadow?f.dropShadowDistance:0)-(f.stroke?f.strokeThickness:0))}),x+=(A+2*o)*s,x=Math.ceil(x)}}b=0;for(var F=u.length;b<F;b++)for(var B=u[b],M=0;M<F;M++){var I=u[M],O=d.measureText(B).width,E=d.measureText(I).width,C=d.measureText(B+I).width-(O+E);C&&p.kerning.push({first:B.charCodeAt(0),second:I.charCodeAt(0),amount:C})}var D=new t(p,_,!0);return void 0!==t.available[e]&&t.uninstall(e),t.available[e]=D,D},t.ALPHA=[["a","z"],["A","Z"]," "],t.NUMERIC=[["0","9"]],t.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],t.ASCII=[[" ","~"]],t.defaultOptions={resolution:1,textureWidth:512,textureHeight:512,padding:4,chars:t.ALPHANUMERIC},t.available={},t}(),pageMeshDataPool=[],charRenderDataPool=[],BitmapText=function(t){function e(r,i){void 0===i&&(i={});var n=t.call(this)||this;n._tint=16777215;var a=Object.assign({},e.styleDefaults,i),o=a.align,s=a.tint,h=a.maxWidth,l=a.letterSpacing,u=a.fontName,f=a.fontSize;if(!BitmapFont.available[u])throw new Error('Missing BitmapFont "'+u+'"');return n._activePagesMeshData=[],n._textWidth=0,n._textHeight=0,n._align=o,n._tint=s,n._fontName=u,n._fontSize=f||BitmapFont.available[u].size,n._text=r,n._maxWidth=h,n._maxLineHeight=0,n._letterSpacing=l,n._anchor=new math.ObservablePoint(function(){n.dirty=!0},n,0,0),n._roundPixels=settings.settings.ROUND_PIXELS,n.dirty=!0,n._textureCache={},n}return __extends(e,t),e.prototype.updateText=function(){for(var t,e=BitmapFont.available[this._fontName],r=this._fontSize/e.size,i=new math.Point,n=[],a=[],o=[],s=this._text.replace(/(?:\r\n|\r)/g,"\n")||" ",h=s.length,l=this._maxWidth*e.size/this._fontSize,u=null,f=0,c=0,p=0,g=-1,d=0,m=0,x=0,v=0,y=0;y<h;y++){var _=s.charCodeAt(y),b=s.charAt(y);if(/(?:\s)/.test(b)&&(g=y,d=f,v++),"\r"!==b&&"\n"!==b){var w=e.chars[_];if(w){u&&w.kerning[u]&&(i.x+=w.kerning[u]);var T=charRenderDataPool.pop()||{texture:core.Texture.EMPTY,line:0,charCode:0,prevSpaces:0,position:new math.Point};T.texture=w.texture,T.line=p,T.charCode=_,T.position.x=i.x+w.xOffset+this._letterSpacing/2,T.position.y=i.y+w.yOffset,T.prevSpaces=v,n.push(T),f=T.position.x+w.texture.orig.width,i.x+=w.xAdvance+this._letterSpacing,x=Math.max(x,w.yOffset+w.texture.height),u=_,-1!==g&&l>0&&i.x>l&&(++m,utils.removeItems(n,1+g-m,1+y-g),y=g,g=-1,a.push(d),o.push(n.length>0?n[n.length-1].prevSpaces:0),c=Math.max(c,d),p++,i.x=0,i.y+=e.lineHeight,u=null,v=0)}}else a.push(f),o.push(-1),c=Math.max(c,f),++p,++m,i.x=0,i.y+=e.lineHeight,u=null,v=0}var S=s.charAt(s.length-1);"\r"!==S&&"\n"!==S&&(/(?:\s)/.test(S)&&(f=d),a.push(f),c=Math.max(c,f),o.push(-1));var A=[];for(y=0;y<=p;y++){var P=0;"right"===this._align?P=c-a[y]:"center"===this._align?P=(c-a[y])/2:"justify"===this._align&&(P=o[y]<0?0:(c-a[y])/o[y]),A.push(P)}var F=n.length,B={},M=[],I=this._activePagesMeshData;for(y=0;y<I.length;y++)pageMeshDataPool.push(I[y]);for(y=0;y<F;y++){var O=(j=n[y].texture).baseTexture.uid;if(!B[O]){if(!(Y=pageMeshDataPool.pop())){var E=new mesh.MeshGeometry,C=new mesh.MeshMaterial(core.Texture.EMPTY);Y={index:0,indexCount:0,vertexCount:0,uvsCount:0,total:0,mesh:new mesh.Mesh(E,C),vertices:null,uvs:null,indices:null}}Y.index=0,Y.indexCount=0,Y.vertexCount=0,Y.uvsCount=0,Y.total=0;var D=this._textureCache;D[O]=D[O]||new core.Texture(j.baseTexture),Y.mesh.texture=D[O],Y.mesh.tint=this._tint,M.push(Y),B[O]=Y}B[O].total++}for(y=0;y<I.length;y++)-1===M.indexOf(I[y])&&this.removeChild(I[y].mesh);for(y=0;y<M.length;y++)M[y].mesh.parent!==this&&this.addChild(M[y].mesh);for(var y in this._activePagesMeshData=M,B){var k=(Y=B[y]).total;if(!((null===(t=Y.indices)||void 0===t?void 0:t.length)>6*k)||Y.vertices.length<2*mesh.Mesh.BATCHABLE_SIZE)Y.vertices=new Float32Array(8*k),Y.uvs=new Float32Array(8*k),Y.indices=new Uint16Array(6*k);else for(var L=Y.total,H=Y.vertices,z=4*L*2;z<H.length;z++)H[z]=0;Y.mesh.size=6*k}for(y=0;y<F;y++){var N=(b=n[y]).position.x+A[b.line]*("justify"===this._align?b.prevSpaces:1);this._roundPixels&&(N=Math.round(N));var j,R=N*r,U=b.position.y*r,W=B[(j=b.texture).baseTexture.uid],X=j.frame,q=j._uvs,G=W.index++;W.indices[6*G+0]=0+4*G,W.indices[6*G+1]=1+4*G,W.indices[6*G+2]=2+4*G,W.indices[6*G+3]=0+4*G,W.indices[6*G+4]=2+4*G,W.indices[6*G+5]=3+4*G,W.vertices[8*G+0]=R,W.vertices[8*G+1]=U,W.vertices[8*G+2]=R+X.width*r,W.vertices[8*G+3]=U,W.vertices[8*G+4]=R+X.width*r,W.vertices[8*G+5]=U+X.height*r,W.vertices[8*G+6]=R,W.vertices[8*G+7]=U+X.height*r,W.uvs[8*G+0]=q.x0,W.uvs[8*G+1]=q.y0,W.uvs[8*G+2]=q.x1,W.uvs[8*G+3]=q.y1,W.uvs[8*G+4]=q.x2,W.uvs[8*G+5]=q.y2,W.uvs[8*G+6]=q.x3,W.uvs[8*G+7]=q.y3}for(var y in this._textWidth=c*r,this._textHeight=(i.y+e.lineHeight)*r,B){var Y=B[y];if(0!==this.anchor.x||0!==this.anchor.y)for(var Z=0,$=this._textWidth*this.anchor.x,J=this._textHeight*this.anchor.y,V=0;V<Y.total;V++)Y.vertices[Z++]-=$,Y.vertices[Z++]-=J,Y.vertices[Z++]-=$,Y.vertices[Z++]-=J,Y.vertices[Z++]-=$,Y.vertices[Z++]-=J,Y.vertices[Z++]-=$,Y.vertices[Z++]-=J;this._maxLineHeight=x*r;var K=Y.mesh.geometry.getBuffer("aVertexPosition"),Q=Y.mesh.geometry.getBuffer("aTextureCoord"),tt=Y.mesh.geometry.getIndex();K.data=Y.vertices,Q.data=Y.uvs,tt.data=Y.indices,K.update(),Q.update(),tt.update()}for(y=0;y<n.length;y++)charRenderDataPool.push(n[y])},e.prototype.updateTransform=function(){this.validate(),this.containerUpdateTransform()},e.prototype.getLocalBounds=function(){return this.validate(),t.prototype.getLocalBounds.call(this)},e.prototype.validate=function(){this.dirty&&(this.updateText(),this.dirty=!1)},Object.defineProperty(e.prototype,"tint",{get:function(){return this._tint},set:function(t){if(this._tint!==t){this._tint=t;for(var e=0;e<this._activePagesMeshData.length;e++)this._activePagesMeshData[e].mesh.tint=t}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"align",{get:function(){return this._align},set:function(t){this._align!==t&&(this._align=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fontName",{get:function(){return this._fontName},set:function(t){if(!BitmapFont.available[t])throw new Error('Missing BitmapFont "'+t+'"');this._fontName!==t&&(this._fontName=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fontSize",{get:function(){return this._fontSize},set:function(t){this._fontSize!==t&&(this._fontSize=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"anchor",{get:function(){return this._anchor},set:function(t){"number"==typeof t?this._anchor.set(t):this._anchor.copyFrom(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"text",{get:function(){return this._text},set:function(t){t=String(null==t?"":t),this._text!==t&&(this._text=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"maxWidth",{get:function(){return this._maxWidth},set:function(t){this._maxWidth!==t&&(this._maxWidth=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"maxLineHeight",{get:function(){return this.validate(),this._maxLineHeight},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"textWidth",{get:function(){return this.validate(),this._textWidth},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"letterSpacing",{get:function(){return this._letterSpacing},set:function(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"roundPixels",{get:function(){return this._roundPixels},set:function(t){t!==this._roundPixels&&(this._roundPixels=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"textHeight",{get:function(){return this.validate(),this._textHeight},enumerable:!1,configurable:!0}),e.prototype.destroy=function(e){var r=this._textureCache;for(var i in r){r[i].destroy(),delete r[i]}this._textureCache=null,t.prototype.destroy.call(this,e)},e.styleDefaults={align:"left",tint:16777215,maxWidth:0,letterSpacing:0},e}(display.Container),BitmapFontLoader=function(){function t(){}return t.add=function(){loaders.LoaderResource.setExtensionXhrType("fnt",loaders.LoaderResource.XHR_RESPONSE_TYPE.TEXT)},t.use=function(e,r){var i=autoDetectFormat(e.data);if(i)for(var n=t.getBaseUrl(this,e),a=i.parse(e.data),o={},s=function(t){o[t.metadata.pageFile]=t.texture,Object.keys(o).length===a.page.length&&(e.bitmapFont=BitmapFont.install(a,o,!0),r())},h=0;h<a.page.length;++h){var l=a.page[h].file,u=n+l,f=!1;for(var c in this.resources){var p=this.resources[c];if(p.url===u){p.metadata.pageFile=l,p.texture?s(p):p.onAfterMiddleware.add(s),f=!0;break}}if(!f){var g={crossOrigin:e.crossOrigin,loadType:loaders.LoaderResource.LOAD_TYPE.IMAGE,metadata:Object.assign({pageFile:l},e.metadata.imageMetadata),parentResource:e};this.add(u,g,s)}}else r()},t.getBaseUrl=function(e,r){var i=r.isDataUrl?"":t.dirname(r.url);return r.isDataUrl&&("."===i&&(i=""),e.baseUrl&&i&&"/"===e.baseUrl.charAt(e.baseUrl.length-1)&&(i+="/")),(i=i.replace(e.baseUrl,""))&&"/"!==i.charAt(i.length-1)&&(i+="/"),i},t.dirname=function(t){var e=t.replace(/\\/g,"/").replace(/\/$/,"").replace(/\/[^\/]*$/,"");return e===t?".":""===e?"/":e},t}();exports.BitmapFont=BitmapFont,exports.BitmapFontData=BitmapFontData,exports.BitmapFontLoader=BitmapFontLoader,exports.BitmapText=BitmapText;
//# sourceMappingURL=text-bitmap.min.js.map
